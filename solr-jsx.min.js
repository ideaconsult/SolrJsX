!function(){Solr={version:"0.9.0"},Solr.Management=function(e){a$.extend(!0,this,e),this.listeners={},this.response=null,this.error=null,this.currentRequest=null,this.pendingRequest=null},Solr.Management.prototype={connector:null,solrUrl:"",servlet:"select",onError:function(e){window.console&&console.log&&console.log(e)},onPrepare:function(e){},onSuccess:null,ajaxSettings:{async:!0,dataType:"json",method:"GET",processData:!1},doRequest:function(e){var t=this,r=null,a={};return null!=t.currentRequest&&t.currentRequest==e?void(t.pendingRequest=e||t.servlet):(t.inRequest=!0,a$.each(t.listeners,function(e){a$.act(e,e.beforeRequest,t)===!1&&(r=e)}),null!==r?void a$.act(r,t.onError,"Request cancelled",r):(a=a$.extend(a,t.ajaxSettings,t.prepareQuery()),a.url=t.solrUrl+(e||t.servlet)+(a.url||""),a.error=t.onError,a.success=function(e){t.parseQuery(t.response=e),a$.each(t.listeners,function(e){a$.act(e,e.afterRequest,t)}),a$.act(t,t.parseResponse,t.response),a$.act(t,t.onSuccess),t.currentRequest=null,t.pendingRequest&&t.doRequest(t.pendingRequest)},a$.broadcast(t,"onPrepare",a),a$.act(t,t.onPrepare,a),t.connector.ajax(a)))},init:function(){var e=this;a$.each(this.listeners,function(t){a$.act(t,t.init,e)})},addListeners:function(e){var t=e;t=arguments.length>1?arguments:Array.isArray(e)?e:[e];for(var r,a=0,n=t.length;a<n;++a)r=t[a],this.listeners[r.id]=r;return this},removeListener:function(e){return delete this.listeners[e.id],this},removeManyListeners:function(e){var t=this;return a$.each(t.listeners(function(r,a){e(r,t)&&delete t.listeners[a]})),t},enumerateListeners:function(e,t){"function"==typeof e&&a$.each(this.listeners,function(r,a){e.call(r,r,a,t)})},getListener:function(e){return this.listeners[e]}},Solr.escapeValue=function(e){return!e.match(/[ :\/"]/)||e.match(/[\[\{]\S+ TO \S+[\]\}]/)||e.match(/^["\(].*["\)]$/)?e:'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},Solr.parseParameter=function(e){var t={},r=e.match(/^([^=]+)=(?:\{!([^\}]*)\})?(.*)$/);if(r){if(null!=r[2])for(var a;a=/([^\s=]+)=?(\S*)?/g.exec(r[2]);)void 0===t.domain&&(t.domain={}),null==a[2]?t.domain.type=a[1]:t.domain[a[1]]=a[2],r[2]=r[2].replace(a[0],"");t.name=r[1];var n=r[3].split(",");t.value=n.length>1?n:r[3]}return t},Solr.Configuring=function(e){a$.extend(!0,this,e);var t=this;this.parameterStore={},a$.each(this.parameters,function(e,r){"string"==typeof e?t.addParameter(Solr.parseParameter(r+"="+e)):t.addParameter(r,e)}),delete e.parameters,delete this.parameters};var e=function(e){return e.match(/^(?:bf|bq|facet\.date|facet\.date\.other|facet\.date\.include|facet\.field|facet\.pivot|facet\.range|facet\.range\.other|facet\.range\.include|facet\.query|fq|group\.field|group\.func|group\.query|pf|qf|stats\.field)$/)};Solr.Configuring.prototype={addParameter:function(t,r,a){var n;if("object"!=typeof t?(n=t,t={name:t,value:r,domain:a}):n=t.name,e(n))if(void 0===this.parameterStore[n])this.parameterStore[n]=[t];else{var i=!1;if(a$.each(this.parameterStore[n],function(e){i=i||a$.equal(!0,t,e)}),i)return!1;this.parameterStore[n].push(t)}else this.parameterStore[n]=t;return t},findParameters:function(t,r){var a,n=[];return void 0!==this.parameterStore[t]&&("function"==typeof r?a=function(e,t){r(e,t)&&n.push(t)}:null==r?a=function(e,t){n.push(t)}:(("object"!=typeof r||r instanceof RegExp||Array.isArray(r))&&(r={value:r}),a=function(e,t){a$.similar(e,r)&&n.push(t)}),a$.each(e(t)?this.parameterStore[t]:[this.parameterStore[t]],a)),n},removeParameters:function(t,r){if(void 0!==this.parameterStore[t]){if("number"==typeof r?r=[r]:Array.isArray(r)||(r=this.findParameters(t,r)),e(t)&&r.length!=this.parameterStore[t].length){r.sort(function(e,t){return e<t?-1:e>t?1:0});for(var a=r.length-1;a>=0;--a)this.parameterStore[t].splice(r[a],1)}else delete this.parameterStore[t];return r.length}return!1},getParameter:function(t,r){if(void 0===this.parameterStore[t]){var a={name:t};this.parameterStore[t]=e(t)?[a]:a}return null!=r&&e(t)?this.parameterStore[t][r]:this.parameterStore[t]},getAllValues:function(t){var r=null;return void 0!==this.parameterStore[t]&&(r=e(t)?this.parameterStore[t].map(function(e){return e.value}):this.parameterStore[t].value),r},enumerateParameters:function(e){a$.each(this.parameterStore,function(t){Array.isArray(t)?a$.each(t,e):e(t)})}},Solr.Compatibility=function(e){a$.extend(!0,this,e),this.store.root=this},Solr.Compatibility.prototype={store:{addByValue:function(e,t,r){return this.root.addParameter(e,t,r)},removeByValue:function(e,t){return this.root.removeParameters(e,indices)},find:function(e,t){return this.root.findParameters(e,neddle)}}},Solr.QueryingURL=function(e){a$.extend(!0,this,e)};var t=function(e){if(Array.isArray(e))return e.join(",");if("object"!=typeof e)return e.toString();var t=[];return a$.each(e,function(e,r){t.push(r+":"+Solr.escapeValue(e))}),t.join(" ")};Solr.QueryingURL.prototype={prepareParameter:function(e){var r=[];return a$.each(e.domain,function(e,t){r.push(("type"!==t?t+"=":"")+e)}),r=r.length>0?"{!"+r.join(" ")+"}":"",e.value||r?e.name+"="+encodeURIComponent(r+t(e.value||"q"==e.name&&"*:*")):null},prepareQuery:function(){var e=[],t=this;return this.enumerateParameters(function(r){var a=t.prepareParameter(r);null!=a&&e.push(a)}),{url:"?"+e.join("&")}},parseQuery:function(e){}};var r=function(e){switch(e){case"fq":return"filter";case"q":return"query";case"fl":return"fields";case"rows":return"limit";case"start":return"offset";case"f":return"facet";case"ex":return"excludeTags";default:var t=e.match(/^json\./);return t?e.substr(t[0].length):null}};Solr.QueryingJson=function(e){a$.extend(!0,this,e)},Solr.QueryingJson.prototype={__depends:[Solr.QueryingURL],prepareQuery:function(){var e=this,t=[],a={};return e.enumerateParameters(function(e){var n=r(e.name);n&&"object"==typeof e.value?a$.path(a,n,a$.extend({},e.value,{domain:e.domain})):(n=a$.act(this,Solr.QueryingURL.prototype.prepareParam,e),null!=n&&t.push(n))}),console.log("Query URL: "+t.join("&")+" Data: "+JSON.stringify(a)),{url:"?"+t.join("&"),data:a}},parseQuery:function(e){}},Solr.Persistency=function(e){a$.extend(!0,this,e),this.storage={}},Solr.Persistency.prototype={__depends:[Solr.Configuring],persistentParams:[],addParameter:function(e,t,r){return a$.pass(this,"addParameter",Solf.Configuring,e,t,r),e},removeParameters:function(e){a$.pass(this,"removeParameters",Solf.Configuring,e)},onPrepare:function(e){}},Solr.Paging=function(e){a$.extend(!0,this,e),this.manager=null,this.currentPage=this.totalPages=this.totalEntries=null},Solr.Paging.prototype={pageSize:20,multivalue:!1,exclusion:!1,domain:null,init:function(e){this.manager=e,this.manager.addParameter("rows",this.pageSize)},setPage:function(e){return null!=this.totalPages&&("next"===e||">"===e?e=this.currentPage+1:"prev"===e||"previous"===e||"<"===e?e=this.currentPage-1:"first"===e||"start"===e?e=1:"last"===e||"end"===e?e=this.totalPages:"number"!=typeof e&&(e=parseInt(e)),!(e>this.totalPages||e<1||e===this.currentPage)&&(this.currentPage=e,this.manager.addParameter("start",(e-1)*this.pageSize,this.domain)))},page:function(e){return void 0!==e&&this.setPage(e),this.currentPage},previousPage:function(){return this.currentPage>1?this.currentPage-1:null},nextPage:function(){return this.currentPage<this.totalPages?this.currentPage+1:null},afterRequest:function(){var e=parseInt(this.manager.response.responseHeader&&this.manager.response.responseHeader.params&&this.manager.response.responseHeader.params.start||this.manager.getParameter("start").value||0);this.pageSize=parseInt(this.manager.response.responseHeader&&this.manager.response.responseHeader.params&&this.manager.response.responseHeader.params.rows||this.manager.getParameter("rows").value||this.pageSize),this.totalEntries=parseInt(this.manager.response.response.numFound),this.currentPage=Math.floor(e/this.pageSize)+1,this.totalPages=Math.ceil(this.totalEntries/this.pageSize)},clickHandler:function(e){var t=this;return function(){return t.setPage(e)&&t.manager.doRequest(),!1}}},Solr.Texting=function(e){a$.extend(!0,this,e),this.manager=null,this.delayTimer=null},Solr.Texting.prototype={delayed:!1,domain:null,init:function(e){this.manager=e},doRequest:function(){if(null==this.delayed)return this.manager.doRequest();null!=this.delayTimer&&clearTimeout(this.delayTimer);var e=this;this.delayTimer=setTimeout(function(){e.manager.addParameter("start",0),e.manager.doRequest(),e.delayTimer=null},this.delayed)},set:function(e){var t=this.manager.getParameter("q"),r=this.manager.addParameter("q",e,this.domain);return after=this.manager.getParameter("q"),r&&!a$.equal(t,after)},clear:function(){return this.manager.removeParameters("q")},unclickHandler:function(){var e=this;return function(){return e.clear()&&e.doRequest(),!1}},clickHandler:function(e){var t=this;return function(){return t.set(e)&&t.doRequest(),!1}}};var a={prefix:null,sort:null,limit:null,offset:null,mincount:null,missing:null,method:null,"enum.cache.minDf":null},n=function(e){return Array.isArray(e)?1==e.length?Solr.escapeValue(e[0]):"("+e.map(function(e){return Solr.escapeValue(e)}).join(" ")+")":Solr.escapeValue(e)},i=/\s*\(\s*?/,s=/\s*\)\s*$/;Solr.parseFacet=function(e){var t=e.match(/^(-)?([^\s:]+):(.+)$/);if(!t)return null;for(var r={field:t[2],exclude:!!t[1]},a=t[3].replace(i,"").replace(s,"").replace(/\\"/g,"%0022").match(/[^\s"]+|"[^"]+"/g),n=0,o=a.length;n<o;++n)a[n]=a[n].replace(/^"/,"").replace(/"$/,"").replace("%0022",'"');return r.value=o>1?a:a[0],r},Solr.Faceting=function(e){a$.extend(!0,this,e),this.manager=null,this.multivalue||(this.aggregate=!1),this.fieldRegExp=new RegExp("^-?"+this.field+":")},Solr.Faceting.prototype={multivalue:!1,aggregate:!1,exclusion:!1,domain:null,facet:{},init:function(e){this.manager=e;var t=a$.extend({},a),r=null,n=this;this.exclusion&&(this.domain=a$.extend(this.domain,{tag:this.id+"_tag"}),r={ex:this.id+"_tag"}),this.manager.addParameter("facet",!0),void 0!==this.facet.date?(this.manager.addParameter("facet.date",this.field,r),a$.extend(t,{"date.start":null,"date.end":null,"date.gap":null,"date.hardend":null,"date.other":null,"date.include":null})):void 0!==this.facet.range?(this.manager.addParameter("facet.range",this.field,r),a$.extend(t,{"range.start":null,"range.end":null,"range.gap":null,"range.hardend":null,"range.other":null,"range.include":null})):(this.facet.field=!0,this.manager.addParameter("facet.field",this.field,r)),t=a$.common(this.facet,t),a$.each(t,function(e,t){n.manager.addParameter("f."+n.field+".facet."+t,e)})},addValue:function(e,t){this.multivalue||this.clearValues();var r;if(!this.aggregate||!(r=this.manager.findParameters("fq",this.fieldRegExp)).length)return this.manager.addParameter("fq",this.fq(e,t),this.domain);var a=this.manager.getParameter("fq",r[0]),n=Solr.parseFacet(a.value),i=!1;Array.isArray(e)||(e=[e]);for(var s,o=0,u=e.length;o<u;++o)s=e[o],n.value!=s&&(Array.isArray(n.value)&&n.value.indexOf(s)>=0||("string"==typeof n.value&&(n.value=[n.value]),n.value.push(s),i=!0));return!!i&&(a.value=this.fq(n.value,t),!0)},removeValue:function(e){if(this.multivalue){var t=this,r=!1;return this.manager.removeParameters("fq",function(a){var i,s;return!!a.value.match(t.fieldRegExp)&&(t.aggregate?(i=Solr.parseFacet(a.value),Array.isArray(e)||(e=[e]),Array.isArray(i.value)?(i.value=i.value.filter(function(t){return e.indexOf(t)==-1||(r=!0,!1)}),!i.value.length||(1==i.value.length&&(i.value=i.value[0]),a.value=t.fq(i.value),!1)):(r=r||(s=e.indexOf(i.value)>=0),s)):(r=r||(s=a.value.indexOf(n(e))>=0),s))}),r}return this.clearValues()},hasValue:function(e){for(var t,r=this.manager.findParameters("fq",this.fieldRegExp),e=Solr.escapeValue(e),a=0,n=r.length;a<n;++a)if(t=this.manager.getParameter("fq",r[a]),t.value.replace(this.fieldRegExp,"").indexOf(e)>-1)return!0;return!1},clearValues:function(){return this.manager.removeParameters("fq",this.fieldRegExp)},getFacetCounts:function(){var e;if(void 0!==this.facet.field?e="facet_fields":void 0!==this.facet.date?e="facet_dates":void 0!==this.facet.range&&(e="facet_ranges"),void 0!==e)switch(this.manager.getParameter("json.nl").value){case"map":return this.getFacetCountsMap(e);case"arrarr":return this.getFacetCountsArrarr(e);default:return this.getFacetCountsFlat(e)}throw'Cannot get facet counts unless one of the following properties is set to "true" on widget "'+this.id+'": "facet.field", "facet.date", or "facet.range".'},getFacetCountsMap:function(e){var t=[];for(var r in this.manager.response.facet_counts[e][this.field])t.push({facet:r,count:parseInt(this.manager.response.facet_counts[e][this.field][r])});return t},getFacetCountsArrarr:function(e){for(var t=[],r=0,a=this.manager.response.facet_counts[e][this.field].length;r<a;r++)t.push({facet:this.manager.response.facet_counts[e][this.field][r][0],count:parseInt(this.manager.response.facet_counts[e][this.field][r][1])});return t},getFacetCountsFlat:function(e){for(var t=[],r=0,a=this.manager.response.facet_counts[e][this.field].length;r<a;r+=2)t.push({facet:this.manager.response.facet_counts[e][this.field][r],count:parseInt(this.manager.response.facet_counts[e][this.field][r+1])});return t},doRequest:function(){this.manager.addParameter("start",0),this.manager.doRequest()},clickHandler:function(e){var t=this;return function(r){return t.addValue(e)&&t.doRequest(),!1}},unclickHandler:function(e){var t=this;return function(r){return t.removeValue(e)&&t.doRequest(),!1}},fq:function(e,t){return(t?"-":"")+this.field+":"+n(e)}},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=Solr:(this.Solr=Solr,"function"==typeof define&&define.amd&&define(Solr))}();
